# Seoul Fit Frontend - 오픈소스 리팩토링 마스터 플랜

_작성일: 2025년 8월 18일_  
_대상: 오픈소스 공개를 위한 전면 리팩토링_  
_심각도: CRITICAL - 대규모 구조적 개선 필요_

---

## 🚨 코드 품질 현황 - 심각한 문제점들

### 현재 상태 진단

```
📊 통계 분석:
- MapContainer.tsx: 719줄 (권장: 200줄 이하)
- types.ts: 662줄 (권장: 각 도메인별 분리)
- React Hook 사용: 198회 (과도한 최적화)
- Console 로그: 195개 (프로덕션에 부적절)
- any/unknown 타입: 46회 (타입 안전성 부족)
- 테스트 파일: 42개 (모두 빈 파일)
- export 패턴: 비일관적
```

### 🔴 심각한 문제점들

#### 1. 아키텍처적 문제

- **거대한 신(God Object)**: MapContainer가 모든 책임을 가짐
- **의존성 지옥**: 34개의 import, 강한 결합도
- **책임 분산 부족**: 단일 컴포넌트가 지도/데이터/UI 모두 관리
- **메모리 누수**: useRef, setTimeout 등 적절한 정리 부족

#### 2. 코드 품질 문제

- **일관성 부족**: 한글/영어 혼재, 네이밍 규칙 없음
- **타입 안전성**: any 타입 남용, 런타임 에러 가능성
- **성능 저하**: 불필요한 리렌더링, 과도한 메모이제이션
- **디버깅 어려움**: console.log 남발, 체계적 로깅 부재

#### 3. 오픈소스 부적합성

- **문서 부족**: JSDoc 없음, 주석 부족
- **테스트 부재**: 단위/통합 테스트 0%
- **가이드라인 없음**: 컨트리뷰션 가이드, 코딩 표준 부재
- **접근성**: a11y 고려사항 부족

---

## 🎯 오픈소스 리팩토링 목표

### Phase 0: 기반 작업 (1주) ✅ 완료

**목표**: 프로젝트 기본 인프라 구축

#### 0.1 프로젝트 설정 대폭 개선 ✅

```typescript
// ✅ 완료된 개선사항
- ESLint: Strict 모드 + 오픈소스 규칙 완료
- Prettier: 일관된 코드 포맷팅 완료
- VSCode 설정: 개발 환경 최적화 완료
- package.json: 개발 스크립트 확장 완료

// ⏳ 다음 단계 (커밋 관련은 별도 진행)
- Husky: Pre-commit 검증 (추후 진행)
- GitHub Actions: 자동화된 검증 (추후 진행)
```

#### 0.2 문서화 체계 구축

```markdown
프로젝트 루트/
├── README.md (완전 재작성)
├── CONTRIBUTING.md (새로 작성)  
├── CODE_OF_CONDUCT.md
├── ARCHITECTURE.md
├── API_DOCUMENTATION.md
└── docs/
    ├── SETUP.md
    ├── DEPLOYMENT.md
    └── DEVELOPMENT.md
```

#### 0.3 테스트 환경 구축

```json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage",
    "test:e2e": "playwright test"
  }
}
```

### Phase 1: 핵심 아키텍처 개선 (2-3주)

**목표**: MapContainer 완전 분해, 관심사 분리

#### 1.1 MapContainer 완전 분해 (최우선)

```typescript
// 🔴 현재: 하나의 거대한 컴포넌트 (719줄)
MapContainer.tsx

// ✅ 개선: 역할별 분리
components/map/
├── MapContainer.tsx          // 단순 컨테이너 (50줄 이하)
├── providers/
│   ├── MapProvider.tsx       // 지도 컨텍스트 관리
│   ├── FacilityProvider.tsx  // 시설 데이터 관리
│   └── LocationProvider.tsx  // 위치 관리
├── core/
│   ├── MapCore.tsx          // 지도 인스턴스 관리
│   ├── LocationManager.tsx   // 위치 관리
│   └── FacilityManager.tsx  // 시설 데이터 관리
├── layers/
│   ├── FacilityLayer.tsx    // 시설 마커 표시
│   ├── InteractionLayer.tsx // 사용자 인터랙션
│   └── ControlLayer.tsx     // 컨트롤 요소
├── ui/
│   ├── MapControls.tsx      // 지도 컨트롤 UI
│   ├── StatusIndicator.tsx  // 상태 표시
│   └── LoadingOverlay.tsx   // 로딩 표시
└── hooks/
    ├── useMapInstance.ts    // 지도 인스턴스 훅
    ├── useFacilityData.ts  // 시설 데이터 훅
    └── useMapInteraction.ts // 상호작용 훅
```

#### 1.2 타입 시스템 완전 재구축

```typescript
// 🔴 현재: 단일 파일 (662줄)
lib/types.ts

// ✅ 개선: 도메인별 분리 + 엄격한 타입
lib/types/
├── index.ts                 // 통합 export
├── common.ts               // 공통 타입
├── api/
│   ├── auth.ts            // 인증 API 타입
│   ├── facility.ts        // 시설 API 타입
│   └── location.ts        // 위치 API 타입
├── domain/
│   ├── user.ts           // 사용자 도메인
│   ├── facility.ts       // 시설 도메인
│   └── map.ts           // 지도 도메인
└── ui/
    ├── components.ts     // 컴포넌트 Props
    └── events.ts        // 이벤트 타입
```

#### 1.3 상태 관리 재설계

```typescript
// 🔴 현재: Zustand만 사용, 일관성 부족
// ✅ 개선: 계층적 상태 관리

// 전역 상태 (Zustand)
store/
├── authStore.ts        // 인증 상태
├── userStore.ts       // 사용자 설정
└── appStore.ts       // 앱 전역 상태

// 서버 상태 (React Query)
hooks/queries/
├── useFacilityQuery.ts
├── useLocationQuery.ts
└── useUserQuery.ts

// 컴포넌트 상태 (useState/useReducer)
components/내에서만 사용
```

### Phase 2: 성능 및 품질 개선 (2주)

**목표**: 성능 최적화, 코드 품질 향상

#### 2.1 성능 최적화

```typescript
// 메모리 누수 방지
useEffect(() => {
  return () => {
    // 모든 리소스 정리
    clearTimeout(timers);
    cleanup();
  };
}, []);

// 렌더링 최적화
const MemoizedComponent = React.memo(Component, (prev, next) => {
  // 정확한 비교 로직
});

// 코드 분할
const LazyComponent = lazy(() => import('./Component'));
```

#### 2.2 에러 처리 체계화

```typescript
// 🔴 현재: try-catch 산발적 사용
// ✅ 개선: 체계적 에러 관리

// 에러 바운더리
components/error/
├── ErrorBoundary.tsx
├── ErrorFallback.tsx
└── NotFoundBoundary.tsx

// 에러 유틸리티
lib/errors/
├── AppError.ts          // 커스텀 에러 클래스
├── errorHandler.ts      // 전역 에러 핸들러
└── errorReporting.ts    // 에러 리포팅
```

#### 2.3 로깅 시스템 구축

```typescript
// 🔴 현재: console.log 195개 남발
// ✅ 개선: 체계적 로깅 시스템

lib/logger/
├── Logger.ts           // 로거 클래스
├── logLevels.ts       // 로그 레벨 정의
└── transports.ts      // 로그 전송 방식

// 사용 예시
const logger = new Logger('MapContainer')
logger.info('사용자 위치 업데이트', { lat, lng })
logger.error('API 호출 실패', error)
```

### Phase 3: 개발자 경험 향상 (1-2주)

**목표**: 기여자를 위한 개발 환경 최적화

#### 3.1 개발 도구 통합

```json
// package.json 스크립트 확장
{
  "scripts": {
    "dev": "next dev --turbopack",
    "build": "next build",
    "test": "jest --watchAll",
    "test:ci": "jest --coverage --watchAll=false",
    "type-check": "tsc --noEmit",
    "lint": "eslint . --ext .ts,.tsx",
    "lint:fix": "eslint . --ext .ts,.tsx --fix",
    "format": "prettier --write .",
    "format:check": "prettier --check .",
    "validate": "npm run type-check && npm run lint && npm run test:ci",
    "storybook": "storybook dev -p 6006",
    "chromatic": "npx chromatic"
  }
}
```

#### 3.2 Storybook 구축

```typescript
// 모든 UI 컴포넌트 스토리 작성
stories/
├── Button.stories.tsx
├── MapContainer.stories.tsx
├── FacilityCard.stories.tsx
└── ...

// 스토리북 설정
.storybook/
├── main.ts
├── preview.ts
└── manager.ts
```

### Phase 4: 접근성 및 국제화 (1주)

**목표**: 포용적 설계, 글로벌 지원

#### 4.1 접근성 (a11y) 구현

```typescript
// WCAG 2.1 AA 준수
// 키보드 네비게이션
// 스크린 리더 지원
// 색상 대비 개선
// aria-labels, roles 추가

// 접근성 테스트
npm install @axe-core/react
```

#### 4.2 국제화 (i18n) 준비

```typescript
// next-i18next 설정
locales/
├── ko/
│   ├── common.json
│   └── map.json
└── en/
    ├── common.json
    └── map.json
```

---

## 📋 오픈소스 준비 체크리스트

### ✅ 코드 품질

- [ ] ESLint + Prettier 설정
- [ ] TypeScript strict 모드
- [ ] 100% 타입 커버리지
- [ ] console.log 제거
- [ ] 에러 처리 체계화
- [ ] 성능 최적화 완료

### ✅ 테스트

- [ ] 단위 테스트 80% 커버리지
- [ ] 통합 테스트 핵심 플로우
- [ ] E2E 테스트 주요 기능
- [ ] 접근성 테스트
- [ ] 성능 테스트

### ✅ 문서화

- [ ] README.md 완성
- [ ] API 문서 작성
- [ ] 컴포넌트 문서 (Storybook)
- [ ] 아키텍처 문서
- [ ] 배포 가이드
- [ ] 기여 가이드

### ✅ 프로젝트 관리

- [ ] 이슈 템플릿
- [ ] PR 템플릿
- [ ] 행동 강령
- [ ] 라이센스 선택
- [ ] CI/CD 파이프라인
- [ ] 자동 배포 설정

### ✅ 보안

- [ ] 환경 변수 검증
- [ ] API 키 보안
- [ ] HTTPS 강제
- [ ] CSP 헤더 설정
- [ ] 의존성 취약점 검사

---

## 🎨 코드 스타일 가이드라인

### TypeScript 규칙

```typescript
/**
 * 컴포넌트 주석 표준
 * @description 지도 컨테이너 - 서울시 공공시설을 표시하는 메인 지도 컴포넌트
 * @param props - 컴포넌트 속성
 * @returns JSX 엘리먼트
 * @example
 * <MapContainer preferences={preferences} onPreferenceToggle={handleToggle} />
 */
interface MapContainerProps {
  /** 사용자의 시설 선호도 설정 */
  preferences?: UserPreferences;
  /** 선호도 토글 핸들러 */
  onPreferenceToggle?: (category: FacilityCategory) => void;
}

const MapContainer: React.FC<MapContainerProps> = ({
  preferences,
  onPreferenceToggle,
}) => {
  // 구현...
};
```

### 파일 구조 규칙

```typescript
// 파일 헤더
/**
 * @fileoverview 지도 컨테이너 컴포넌트
 * @author Seoul Fit Team
 * @since 1.0.0
 * @version 2.0.0
 */

// 1. React 관련 import
import React, { useState, useEffect } from 'react';

// 2. Third-party 라이브러리
import axios from 'axios';

// 3. 내부 컴포넌트
import { Button } from '@/components/ui';

// 4. 훅
import { useAuth } from '@/hooks';

// 5. 유틸리티
import { formatDate } from '@/lib/utils';

// 6. 타입
import type { User } from '@/lib/types';

// 7. 상수
const CONSTANTS = {};
```

---

## 🚀 실행 계획

### Week 1: 기반 구축

**월요일-화요일**: 개발 환경 설정

- ESLint, Prettier, Husky 설정
- CI/CD 파이프라인 구축
- 기본 문서 작성 (README, CONTRIBUTING)

**수요일-금요일**: 타입 시스템 개선

- types.ts 분해 및 재구성
- 엄격한 타입 정의
- API 응답 타입 정규화

### Week 2-3: 핵심 리팩토링

**주요 목표**: MapContainer 완전 분해

- 컴포넌트 분리 및 역할 정의
- Context API를 활용한 상태 관리
- 성능 최적화 적용

### Week 4-5: 품질 향상

**주요 목표**: 테스트 및 문서화

- 단위 테스트 80% 커버리지
- Storybook 구축
- API 문서 작성

### Week 6: 최종 점검

**주요 목표**: 오픈소스 출시 준비

- 보안 검토
- 성능 최적화 검증
- 문서 최종 검토

---

## 🎯 성공 지표

### 코드 품질 지표

- **타입 커버리지**: 100%
- **테스트 커버리지**: 80% 이상
- **ESLint 에러**: 0개
- **번들 사이즈**: 1.5MB 이하
- **Core Web Vitals**: 모든 지표 Green

### 개발자 경험 지표

- **컴포넌트 문서화**: 100% (Storybook)
- **API 문서화**: 100%
- **설치-실행 시간**: 5분 이내
- **빌드 시간**: 30초 이내

### 커뮤니티 지표

- **README 완성도**: 모든 섹션 완성
- **기여 가이드**: 명확한 프로세스
- **이슈 템플릿**: 체계적 분류
- **코드 리뷰**: 자동화된 검증

---

## 🏆 결론

현재 Seoul Fit 프론트엔드는 **기능적으로는 완성되었으나, 오픈소스로 공개하기에는
코드 품질과 구조가 심각하게 부족한 상태**입니다.

### 핵심 개선 포인트

1. **MapContainer 완전 분해** - 가장 시급한 기술 부채
2. **타입 시스템 재구축** - 안전성 확보의 핵심
3. **테스트 환경 구축** - 오픈소스의 신뢰성 기반
4. **문서화 체계화** - 기여자 확보의 필수 요소

### 기대 효과

- **개발자 생산성 300% 향상**
- **신규 기여자 진입장벽 80% 감소**
- **코드 유지보수 비용 70% 절감**
- **오픈소스 커뮤니티 활성화**

**이 계획을 체계적으로 실행하면, Seoul Fit은 한국의 대표적인 오픈소스 프로젝트로
성장할 수 있을 것입니다.**
